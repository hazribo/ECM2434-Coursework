{% extends 'WebApp/game_base.html' %}
{% load static %}

{% block content %}
<div class="container main-content">
    <div class="card shadow-lg p-4 mb-4 rounded" style="background-color: #e6f4ea;">
        <div class="row align-items-center">
            <!-- Profile Picture -->
            <div class="col-md-4 text-center">
                {% if profile.profile_picture %}
                <img src="{{ profile.profile_picture.url }}" class="rounded-circle border" style="width: 150px; height: 150px;" alt="{{ profile.user.username }}'s Profile Picture">
                {% else %}
                <img src="{% static 'nopfp.png' %}" class="rounded-circle border" style="width: 150px; height: 150px;" alt="No Profile Picture">
                {% endif %}
                <h2 class="mt-3">{{ profile.user.username }}</h2>
                <h4 class="text-muted">Score: {{ profile.score }}</h4>
            </div>

            <!-- Bio Section -->
            <div class="col-md-8">
                <h3>Bio:</h3>
                <p class="border rounded p-3 bg-light">{{ profile.bio|default:"No bio provided." }}</p>
                {% if request.user == profile.user %}
                <a href="{% url 'profile_update' %}" class="btn btn-primary">Edit Profile</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Friend Requests -->
    {% if request.user == profile.user and req_list %}
    <div class="card shadow-lg p-4 mb-4 rounded">
        <h3>Friend Requests</h3>
        <ul class="list-unstyled">
            {% for reqProfile in req_list %}
            <li class="d-flex align-items-center mb-3">
                <img src="{% if reqProfile.hasPfp %}{{ reqProfile.pfpUrl }}{% else %}{% static 'nopfp.png' %}{% endif %}" class="me-2" style="width: 50px; height: 50px;">
                <a href="{{ reqProfile.link }}" class="me-3">{{ reqProfile.name }}</a>
                <form action="{{ reqProfile.acceptURL }}" class="me-2">
                    <button class="btn btn-success btn-sm friend-accept-button">✔ Accept</button>
                </form>
                <form action="{{ reqProfile.rejectURL }}">
                    <button class="btn btn-danger btn-sm friend-reject-button">✖ Reject</button>
                </form>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Friends List -->
    <div class="card shadow-lg p-4 mb-4 rounded">
        <h3>Friends</h3>
        <ul class="list-unstyled d-flex flex-wrap gap-3">
            {% for friendProfile in friend_list %}
            <li class="d-flex align-items-center">
                <img src="{% if friendProfile.hasPfp %}{{ friendProfile.pfpUrl }}{% else %}{% static 'nopfp.png' %}{% endif %}" class="me-2" style="width: 50px; height: 50px;">
                <a href="{{ friendProfile.link }}">{{ friendProfile.name }}</a>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Pet Section -->
    <div class="text-center mb-4">
        <h3>Your Pet!</h3>
        <img src="{% static 'gbc3.png' %}" alt="Bean" width="250" class="border rounded">
    </div>

    <!-- Image Gallery -->
    <div class="card shadow-lg p-4 mb-4 rounded">
        <h3>Images</h3>
        <div class="d-flex flex-wrap gap-3 justify-content-center">
            {% for image in mission_photos %}
            <div class="border rounded p-2">
                <img src="{{ image.image.url }}" alt="User Image" class="img-fluid" style="max-width: 250px;">
            </div>
            {% empty %}
            <p>No images uploaded.</p>
            {% endfor %}
        </div>
    </div>
</div>

<!-- JavaScript for Buttons -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".friend-reject-button").forEach(button => {
            button.addEventListener("click", function () {
                button.innerHTML = "✔ Rejected";
                button.disabled = true;
            });
        });
        document.querySelectorAll(".friend-accept-button").forEach(button => {
            button.addEventListener("click", function () {
                button.innerHTML = "✔ Accepted";
                button.disabled = true;
            });
        });
    });
</script>
{% endblock %}